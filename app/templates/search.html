<html>

<head>
    <title>Karma Farmer</title>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/8ea94d6b77.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/glacial-indifference" type="text/css" />
    <link rel="stylesheet" href="/static/main.css">
</head>

<body>

    <a href="/">
        <strong>
            <p class="logo">Karma-Farmer <i class="fas fa-tractor"></i>
            </p>
        </strong>
    </a>
    <div class="version-select">
        <select id="cars" onchange="location = this.value;">
            <option value="https://karmafarmer.herokuapp.com/">Version 1</option>
            <option value="https://karmafarmer-v2.herokuapp.com/">Version 2</option>
            <option value="V3">Version 3</option>
        </select>
    </div>
    <div style="background-color:#545452">

        <div style=" padding-left: 5%; padding-right: 5%;">
            <div style="background-color: rgb(239, 239, 237, 1);">
                <br><br>
                <div style="padding-left: 2%; padding-right: 2%;">
                    <form name="query-form" onsubmit="validateForm()" class="query-form">
                        <br>
                        <h1 class="title">
                            What would you like to post?
                        </h1>
                        <div class="query-input">
                            <textarea rows="10" cols="10" id="input" type="text" name="search" class="form-control"
                                placeholder="My Post">{{ query }}</textarea>
                        </div>

                        <div>
                            <h5 for="suggested" class="suggested"> <input id="suggested" type="checkbox"
                                    name="suggested" {{ suggested }}> I Want Suggested Words
                            </h5>
                        </div>
                        <br>

                        <div class="form-group">
                            <h1 for="weight"> What should we weigh more?</h1>
                            <br>
                            <p class="slider-label-left">Potential Karma</p>
                            <p class="slider-label-right">Relevancy of Subreddit</p>
                            <br>
                            <div>
                                <div>
                                    <span class="slider-labels" id="karmaWeight">{{ weight }}%</span> &nbsp;
                                    <input class="slider" id="weight" type="range" name="weight" min="0" max="100"
                                        value={{ weight }}>
                                    &nbsp;
                                    <span class="slider-labels" id="relevancyWeight">{{ weight }}%</span>
                                </div>
                                <br>
                            </div>
                        </div>


                        <button onclick="location.href='#bottom'" type="submit" class="btn">
                            Show Me Subreddits!
                        </button>
                        <br> <br>
                    </form>
                    <br>
                </div>
            </div>
        </div>
    </div>

    <div style="background-color:#545452">
        <div style="padding-left: 5%; padding-right: 5%;">
            <div class="form-group" id="bottom">
                <br>
                <h1>{{ output_message }}</h1>
                {% if query %}
                {% if data|length > 0 %}
                {% for d in data %}
                <div class="result">
                    <strong>subreddit:</strong>
                    <a href="https://reddit.com/r/{{ d['subreddit'] }}" />
                    r/{{d['subreddit']}}
                    </a>
                    <br>
                    <strong>score:</strong> {{ d['score'] }}
                    <br>
                    <strong>karma score:</strong> {{ d['karmaScore'] }}
                    <br>
                    <strong>relevancy score:</strong> {{ d['relevancyScore'] }}
                    <br>
                    {% if d['suggested_words'] %}
                    <strong>suggested words:</strong> {{ d['suggested_words'] }}
                    {% endif %}
                    <div id="{{d['subreddit']}}_info" style="display:none;">
                        <strong>description:</strong> {{d['description']}}
                        <br>
                        <strong>subscribers:</strong> {{d['subscribers']}}
                    </div>
                    <br>
                    <button class="more-btn" onclick="toggleDetails()" id="{{d['subreddit']}}_button">More</button>
                </div>
                <br>
                {% endfor %}
                {% else %}
                <p>No relevant results found, please try a more specific query.</p>
                {% endif %}
                {% endif %}
                <br>
            </div>
        </div>
    </div>
</body>
<footer>Student Name: ({{ netid }})</footer>
<script>
    let weightSelector = document.getElementById("weight");
    let karmaWeight = document.getElementById("karmaWeight");
    let relevancyWeight = document.getElementById("relevancyWeight");
    weightSelector.addEventListener('input', () => {
        karmaWeight.innerHTML = 100 - weightSelector.value + "%";
        relevancyWeight.innerHTML = weightSelector.value + "%";
    }, false);

    const validateForm = () => {
        let x = document.forms["query-form"]["search"].value;
        let y = x.split(/\s/);
        if (y.length < 5) {
            alert("Your post must have at least 5 words!");
            return false;
        }
    }

    const toggleDetails = () => {
        let id = event.target.id.slice(0, -7);
        let info = document.getElementById(id + "_info");
        if (info.style.display === "none") {
            event.target.innerHTML = "Less";
            info.style.display = "block";
        }
        else {
            event.target.innerHTML = "More";
            info.style.display = "none";
        }
    }
</script>

</html>